<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tomatonator Thrower</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="icon" href="icon.png">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  user-select:none;
  -webkit-user-select:none;
  touch-action:none;
}

body{
  background:#7F7F7F;
  font-family:Arial, Helvetica, sans-serif;
  overflow:hidden;
}

/* ===== TOP BAR ===== */
.topbar{
  height:64px;
  background:#8E8E8E;
  display:flex;
  align-items:center;
  gap:32px;
  padding:0 24px;
}

.topbar img{
  height:36px;
}

.nav span{
  cursor:pointer;
  font-size:15px;
}

/* ===== CONTENT ===== */
.content{
  position:relative;
  width:100vw;
  height:calc(100vh - 64px);
}

.mode{
  position:absolute;
  inset:0;
  display:none;
}

.mode.active{
  display:block;
}

/* ===== VISUAL MODE ===== */
#visual{
  position:relative;
}

#template{
  position:absolute;
  inset:0;
  background:url("template.png") center no-repeat;
  background-size:360px auto;
  opacity:1;
  pointer-events:none;
}

/* ===== TOMATO SPRITE ===== */
.tomato{
  position:absolute;
  width:480px;
  height:480px;
  background-image:url("tomato.png");
  background-repeat:no-repeat;
  background-size:600% 1700%;
  pointer-events:none;
}

/* ===== PANELS ===== */
.panel{
  padding:20px;
  font-size:14px;
}
</style>
</head>

<body>

<div class="topbar">
  <img src="icon.png">
  <div class="nav">
    <span data-mode="visual">Visual</span>
    <span data-mode="editor">Editor</span>
    <span data-mode="about">About</span>
  </div>
</div>

<div class="content">

  <div id="visual" class="mode active">
    <div id="template"></div>
  </div>

  <div id="editor" class="mode panel">
    <b>Editor</b><br><br>
    Editing space.
  </div>

  <div id="about" class="mode panel">
    <b>tt.fsp â€” Fire Source Project</b><br><br>

    <b>what's is this for?</b><br>
    it's an web html where it makes the "Tomato Throw meme" easier to recreate ig.<br><br>

    <b>why did u make this html?</b><br>
    just for fun.<br><br>

    <b>what's fsp?</b><br>
    fsp stands for Fire-Source-Project.
  </div>

</div>

<audio id="bgm" src="bgm.ogg" loop></audio>

<script>
/* ===== MODES ===== */
const modes = document.querySelectorAll(".mode");
const visual = document.getElementById("visual");
const bgm = document.getElementById("bgm");

function fadeOutBGM(){
  const fade = setInterval(()=>{
    if(bgm.volume > 0.05){
      bgm.volume -= 0.05;
    }else{
      bgm.pause();
      bgm.currentTime = 0;
      bgm.volume = 1;
      clearInterval(fade);
    }
  }, 50);
}

function setMode(name){
  modes.forEach(m=>m.classList.remove("active"));
  document.getElementById(name).classList.add("active");

  document.querySelectorAll(".tomato").forEach(t=>t.remove());

  if(name === "editor" || name === "about"){
    bgm.play().catch(()=>{});
  }else{
    fadeOutBGM();
  }
}

document.querySelectorAll(".nav span").forEach(btn=>{
  btn.onclick = ()=>setMode(btn.dataset.mode);
});

/* ===== TOMATO ANIMATION ===== */
const FRAMES_X = 6;
const FRAMES_Y = 17;
const LAST_ROW_FRAMES = 5;
const FRAME_TIME = 30;
const SIZE = 480;

function spawnTomato(x, y){
  const t = document.createElement("div");
  t.className = "tomato";
  t.style.left = (x - SIZE/2) + "px";
  t.style.top  = (y - SIZE/2) + "px";
  visual.appendChild(t);

  let col = 0;
  let row = 0;
  const splash = new Audio("splash.ogg");

  const anim = setInterval(()=>{
    const posX = (col / (FRAMES_X - 1)) * 100;
    const posY = (row / (FRAMES_Y - 1)) * 100;

    t.style.backgroundPosition = `-${posX}% -${posY}%`;

    col++;

    const lastRow = row === FRAMES_Y - 1;
    const maxCol = lastRow ? LAST_ROW_FRAMES : FRAMES_X;

    if(col >= maxCol){
      col = 0;
      row++;
    }

    if(row >= FRAMES_Y){
      clearInterval(anim);

      const lastX =
        ((LAST_ROW_FRAMES - 1) / (FRAMES_X - 1)) * 100;

      t.style.backgroundPosition = `-${lastX}% 100%`;

      splash.currentTime = 0;
      splash.play().catch(()=>{});
    }
  }, FRAME_TIME);
}

/* ===== INPUT (PC + MOBILE) ===== */
visual.addEventListener("pointerdown", e=>{
  spawnTomato(e.clientX, e.clientY);
  visual.onpointermove = ev=>{
    spawnTomato(ev.clientX, ev.clientY);
  };
});

window.addEventListener("pointerup", ()=>{
  visual.onpointermove = null;
});
</script>

</body>
</html>
